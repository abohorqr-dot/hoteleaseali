<!doctype html>
<html lang="es">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Hoteleaseali · Panel</title>

    <link rel="stylesheet" href="../css/style.css" />
    <link rel="icon" href="../img/logo.png" />
</head>

<body>

    <!-- Header -->
    <header>
        <div class="container header-inner">
            <a class="brand" href="../index.html">
                <img src="../img/logo.png" alt="Hoteleaseali" style="height:36px;border-radius:8px">
                Hoteleaseali
            </a>
            <nav class="nav">
                <a href="../index.html#modulos">Módulos</a>
                <a href="#" id="logout">Cerrar sesión</a>
            </nav>
        </div>
    </header>

    <!-- Panel -->
    <main class="container" style="padding:32px 0">
        <div class="card stack">
            <h1 style="margin-bottom:.25rem">Panel</h1>
            <p class="lead">Hola, <strong id="userName">—</strong></p>

            <div class="grid auto">
                <article>
                    <h3>Tu cuenta</h3>
                    <ul class="stack" style="list-style:none;padding-left:0">
                        <li>Correo: <strong id="userEmail">—</strong></li>
                        <li>UID: <code id="userUid">—</code></li>
                        <li>Verificado: <strong id="userVerified">—</strong></li>
                        <li>Creación: <span id="createdAt">—</span></li>
                        <li>Último acceso: <span id="lastLogin">—</span></li>
                    </ul>
                </article>

                <article>
                    <h3>Token JWT (para tu API)</h3>
                    <p class="input-help">Úsalo como <code>Authorization: Bearer &lt;token&gt;</code>.</p>
                    <textarea id="idToken" rows="6" readonly
                        style="width:100%;border-radius:12px;padding:10px"></textarea>
                    <div class="stack" style="margin-top:10px">
                        <button id="copyToken">Copiar token</button>
                        <button id="refreshToken" class="btn">Refrescar token</button>
                    </div>
                </article>
            </div>
        </div>

        <section class="stack" style="margin-top:22px">
            <div class="card">
                <h3>Accesos rápidos</h3>
                <div class="hero-actions" style="margin-top:10px">
                    <a class="btn" href="../index.html#reservas">Ir a Reservas</a>
                    <a class="btn ghost" href="../index.html#clientes">Ir a Clientes</a>
                    <a class="btn ghost" href="../index.html#pagos">Ir a Pagos</a>
                </div>
            </div>
        </section>
    </main>

    <footer>
        <small>© 2025 Hoteleaseali</small>
    </footer>

    <!-- Inicializa Firebase -->
    <script type="module" src="./firebase-init.js"></script>

    <!-- Lógica del panel (ruta protegida) -->
    <script type="module">
        import { auth } from "./firebase-init.js";
        import { onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";

        const el = (id) => document.getElementById(id);

        // Proteger la ruta: si no hay usuario, llevar a login
        onAuthStateChanged(auth, async (user) => {
            if (!user) {
                window.location.href = "./login.html";
                return;
            }

            // Datos básicos
            el("userName").textContent = user.displayName || user.email || "Usuario";
            el("userEmail").textContent = user.email || "—";
            el("userUid").textContent = user.uid;
            el("userVerified").textContent = user.emailVerified ? "Sí" : "No";
            el("createdAt").textContent = user.metadata?.creationTime || "—";
            el("lastLogin").textContent = user.metadata?.lastSignInTime || "—";

            // Token JWT
            const token = await user.getIdToken(/* forceRefresh */ false);
            el("idToken").value = token;
        });

        // Copiar token al portapapeles
        el("copyToken").addEventListener("click", async () => {
            try {
                await navigator.clipboard.writeText(el("idToken").value);
                alert("Token copiado.");
            } catch { alert("No se pudo copiar."); }
        });

        // Refrescar token
        el("refreshToken").addEventListener("click", async () => {
            const user = auth.currentUser;
            if (!user) return;
            const token = await user.getIdToken(true);
            el("idToken").value = token;
        });

        // Cerrar sesión
        el("logout").addEventListener("click", async (e) => {
            e.preventDefault();
            await signOut(auth);
            window.location.href = "./login.html";
        });
    </script>
    <script type="module" src="./firebase-init.js"></script>

</body>

</html>