<!doctype html>
<html lang="es">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Hoteleaseali · Registro</title>

    <link rel="stylesheet" href="../css/style.css" />
    <link rel="icon" href="../img/logo.png" />
</head>

<body>

    <!-- Header -->
    <header>
        <div class="container header-inner">
            <a class="brand" href="../index.html">
                <img src="../img/logo.png" alt="Hoteleaseali" style="height:36px;border-radius:8px">
                Hoteleaseali
            </a>
            <nav class="nav">
                <a href="./login.html">Iniciar sesión</a>
                <a href="../index.html#docs">Docs</a>
            </nav>
        </div>
    </header>

    <!-- Registro -->
    <main class="container" style="padding:32px 0">
        <div class="card" style="max-width:480px;margin:auto">
            <h1 style="margin-bottom:.5rem">Crear cuenta</h1>
            <p class="lead" style="color:var(--muted)">Regístrate con tu correo electrónico.</p>

            <form id="regForm" class="stack" novalidate>
                <!-- (opcional) nombre para mostrar -->
                <div class="form-row">
                    <label for="name">Nombre (opcional)</label>
                    <input id="name" type="text" placeholder="Tu nombre">
                </div>

                <div class="form-row">
                    <label for="email">Correo</label>
                    <input id="email" type="email" placeholder="usuario@hotel.com" required />
                </div>

                <div class="form-row">
                    <label for="password">Contraseña</label>
                    <input id="password" type="password" placeholder="Mínimo 8 caracteres" minlength="8" required />
                </div>

                <div class="form-row">
                    <label for="confirm">Confirmar contraseña</label>
                    <input id="confirm" type="password" placeholder="Repite la contraseña" minlength="8" required />
                </div>

                <label style="display:flex;gap:.5rem;align-items:center">
                    <input id="terms" type="checkbox" required> Acepto los términos y condiciones
                </label>

                <button id="btnReg" type="submit">Registrarme</button>
                <p id="msg" class="input-help" style="margin-top:.5rem"></p>
            </form>

            <p class="input-help" style="margin-top:10px">
                ¿Ya tienes cuenta? <a class="module-link" href="./login.html">Inicia sesión</a>
            </p>
        </div>
    </main>

    <footer>
        <small>© 2025 Hoteleaseali</small>
    </footer>

    <!-- Inicializa Firebase -->
    <script type="module" src="./firebase-init.js"></script>

    <!-- Lógica de registro -->
    <script type="module">
        import { auth } from "./firebase-init.js";
        import {
            createUserWithEmailAndPassword,
            updateProfile,
            sendEmailVerification
        } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";

        const form = document.getElementById("regForm");
        const msg = document.getElementById("msg");
        const btn = document.getElementById("btnReg");

        form.addEventListener("submit", async (e) => {
            e.preventDefault();
            msg.textContent = "";
            btn.disabled = true;

            const name = /** @type {HTMLInputElement} */(document.getElementById("name")).value.trim();
            const email = /** @type {HTMLInputElement} */(document.getElementById("email")).value.trim();
            const pass = /** @type {HTMLInputElement} */(document.getElementById("password")).value;
            const conf = /** @type {HTMLInputElement} */(document.getElementById("confirm")).value;
            const terms = /** @type {HTMLInputElement} */(document.getElementById("terms")).checked;

            // Validaciones básicas
            if (!terms) {
                msg.textContent = "Debes aceptar los términos y condiciones.";
                msg.style.color = "#e11d48"; btn.disabled = false; return;
            }
            if (pass !== conf) {
                msg.textContent = "Las contraseñas no coinciden.";
                msg.style.color = "#e11d48"; btn.disabled = false; return;
            }

            try {
                const cred = await createUserWithEmailAndPassword(auth, email, pass);

                // Nombre para mostrar (opcional)
                if (name) {
                    await updateProfile(cred.user, { displayName: name });
                }

                // Enviar verificación (opcional pero recomendado)
                try { await sendEmailVerification(cred.user); } catch { }

                msg.textContent = "Cuenta creada correctamente. Redirigiendo…";
                msg.style.color = "#16a34a";

                // Ir al panel
                window.location.href = "./panel.html";
            } catch (err) {
                const map = {
                    "auth/email-already-in-use": "Ese correo ya está registrado.",
                    "auth/invalid-email": "Correo inválido.",
                    "auth/operation-not-allowed": "Registro deshabilitado.",
                    "auth/weak-password": "Contraseña débil (mínimo 8 caracteres)."
                };
                msg.textContent = map[err.code] || ("Error: " + err.code);
                msg.style.color = "#e11d48";
            } finally {
                btn.disabled = false;
            }
        });
    </script>
    <script type="module" src="./firebase-init.js"></script>

</body>

</html>
