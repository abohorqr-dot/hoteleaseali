<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Hoteleaseali ¬∑ Registro</title>
  <link rel="stylesheet" href="../css/style.css">
  <link rel="icon" href="../img/logo.png">
</head>
<body>
<header>
  <div class="container header-inner">
    <a class="brand" href="../index.html"><img src="../img/logo.png" alt="">Hoteleaseali</a>
    <nav class="nav"><a href="./login.html">Iniciar sesi√≥n</a><a href="./panel.html">Panel</a></nav>
  </div>
</header>

<main class="container" style="padding:32px 0">
  <div class="card" style="max-width:720px;margin:auto">
    <h1>Crear cuenta</h1>
    <p class="lead">Reg√≠strate con tu correo electr√≥nico.</p>

    <!-- Mensajes -->
    <div id="status" style="display:none;margin:8px 0;padding:10px;border-radius:10px;background:#fffbe6;border:1px solid #f3d08b;color:#7a5900"></div>

    <!-- üëá evita recarga incluso si el JS falla -->
    <form id="register-form" action="javascript:void(0)" novalidate class="form-row" style="margin-top:12px">
      <label>Nombre (opcional)
        <input name="name" type="text" placeholder="Tu nombre">
      </label>
      <label>Correo
        <input name="email" type="email" placeholder="usuario@hotel.com" required>
      </label>
      <label>Contrase√±a
        <input name="password" type="password" minlength="6" placeholder="M√≠nimo 6 caracteres" required>
      </label>
      <label>Confirmar contrase√±a
        <input name="password2" type="password" minlength="6" placeholder="Repite la contrase√±a" required>
      </label>

      <label style="display:flex;gap:8px;align-items:flex-start;margin-top:6px">
        <input name="terms" type="checkbox" required>
        <span>Acepto los t√©rminos y condiciones</span>
      </label>

      <button id="submit" class="btn" type="submit" style="margin-top:8px">Registrarme</button>
      <p style="margin-top:10px">¬øYa tienes cuenta? <a class="module-link" href="./login.html">Inicia sesi√≥n</a></p>
    </form>
  </div>
</main>

<footer><small>¬© 2025 Hoteleaseali</small></footer>

<!-- 1) Carga Firebase -->
<script type="module" src="./firebase-init.js?v=8"></script>

<!-- 2) L√≥gica de registro -->
<script type="module">
import { auth } from './firebase-init.js?v=8';
import {
  createUserWithEmailAndPassword,
  updateProfile,
  sendEmailVerification
} from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";

const $ = (s) => document.querySelector(s);
const form   = $('#register-form');
const status = $('#status');
const btn    = $('#submit');

function show(msg){ status.textContent = msg; status.style.display='block'; }
function clear(){ status.style.display='none'; status.textContent=''; }

// üö® Si firebase-init.js no carg√≥, avisa
if (!window.__FIREBASE_READY__) {
  show('No se pudo cargar Firebase. Revisa la ruta de "firebase-init.js".');
  console.error('firebase-init.js NO carg√≥');
}

form.addEventListener('submit', async () => {
  clear();

  const name  = (form.name?.value || '').trim();
  const email = form.email?.value?.trim();
  const pass  = form.password?.value;
  const pass2 = form.password2?.value;
  const terms = form.terms?.checked;

  if (!email || !pass || !pass2) return show('Completa todos los campos.');
  if (!terms) return show('Acepta los t√©rminos y condiciones.');
  if (pass !== pass2) return show('Las contrase√±as no coinciden.');

  btn.disabled = true; btn.textContent = 'Registrando‚Ä¶'; show('Creando cuenta‚Ä¶');

  try {
    const { user } = await createUserWithEmailAndPassword(auth, email, pass);
    if (name) await updateProfile(user, { displayName: name });

    // Enviar verificaci√≥n
    await sendEmailVerification(user, {
      url: 'https://abohorqr-dot.github.io/hoteleaseali/docs/login.html'
    });

    show('¬°Listo! Te enviamos un correo para verificar tu email.');
    alert('Te enviamos un correo de verificaci√≥n. Abre el enlace y luego inicia sesi√≥n.');
    location.href = './login.html';
  } catch (err) {
    console.error('REGISTER ERROR:', err);
    const map = {
      'auth/email-already-in-use': 'Ese correo ya est√° registrado.',
      'auth/invalid-email': 'Correo inv√°lido.',
      'auth/weak-password': 'La contrase√±a es muy corta (m√≠n. 6).',
      'auth/network-request-failed': 'Sin conexi√≥n. Revisa tu red.'
    };
    show(map[err.code] || err.message);
    alert(map[err.code] || err.message);
  } finally {
    btn.disabled = false; btn.textContent = 'Registrarme';
  }
});
</script>
</body>
</html>
