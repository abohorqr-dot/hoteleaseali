<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Hoteleaseali · Iniciar sesión</title>
  <link rel="stylesheet" href="../css/style.css">
  <link rel="icon" href="../img/logo.png">
</head>
<body>
<header>
  <div class="container header-inner">
    <a class="brand" href="../index.html"><img src="../img/logo.png" alt="">Hoteleaseali</a>
    <nav class="nav">
      <a href="./registro.html">Registro</a>
      <a href="./panel.html">Panel</a>
    </nav>
  </div>
</header>

<main class="container" style="padding:32px 0">
  <div class="card" style="max-width:680px;margin:auto">
    <h1>Iniciar sesión</h1>
    <p class="lead">Accede con tu correo y contraseña.</p>

    <!-- Mensajes / debug -->
    <div id="status" style="display:none;margin:8px 0;padding:10px;border-radius:10px;background:#fffbe6;border:1px solid #f3d08b;color:#7a5900"></div>

    <form id="login-form" class="form-row" style="margin-top:12px">
      <label>Correo
        <input name="email" type="email" placeholder="usuario@hotel.com" required>
      </label>
      <label>Contraseña
        <input name="password" type="password" required>
      </label>

      <label style="display:flex;gap:8px;align-items:center;margin-top:6px">
        <input id="remember" type="checkbox"> Recordarme
      </label>

      <div style="display:flex;gap:12px;align-items:center;margin-top:10px">
        <button id="submit" class="btn" type="submit">Ingresar</button>
        <a id="reset-link" href="#" class="module-link">¿Olvidaste tu contraseña?</a>
      </div>

      <p style="margin-top:10px">¿No tienes cuenta? <a class="module-link" href="./registro.html">Regístrate</a></p>
    </form>
  </div>
</main>

<footer><small>© 2025 Hoteleaseali</small></footer>

<!-- IMPORTANTE: primero init, luego el script -->
<script type="module" src="./firebase-init.js?v=5"></script>
<script type="module">
import { auth } from './firebase-init.js?v=5';
import {
  signInWithEmailAndPassword,
  sendPasswordResetEmail,
  setPersistence,
  browserLocalPersistence,
  browserSessionPersistence
} from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";

const $ = (s) => document.querySelector(s);
const form   = $('#login-form');
const status = $('#status');
const btn    = $('#submit');

function show(msg){
  status.textContent = msg;
  status.style.display = 'block';
}
function clear(){ status.style.display = 'none'; status.textContent=''; }

form?.addEventListener('submit', async (e) => {
  e.preventDefault();
  clear();

  // Campos
  const email = form.email?.value?.trim();
  const pass  = form.password?.value;

  if(!email || !pass){
    show('Completa correo y contraseña.');
    return;
  }

  // Persistencia según "Recordarme"
  const remember = $('#remember')?.checked;
  btn.disabled = true; btn.textContent = 'Ingresando…';
  show('Conectando…');

  try {
    await setPersistence(auth, remember ? browserLocalPersistence : browserSessionPersistence);
    const cred = await signInWithEmailAndPassword(auth, email, pass);
    show('Listo. Redirigiendo…');
    // Redirige al panel
    location.href = './panel.html';
  } catch (err) {
    console.error('LOGIN ERROR:', err);
    const map = {
      'auth/invalid-credential': 'Correo o contraseña inválidos.',
      'auth/user-not-found': 'El usuario no existe.',
      'auth/wrong-password': 'Contraseña incorrecta.',
      'auth/too-many-requests': 'Demasiados intentos. Intenta más tarde.',
      'auth/network-request-failed': 'Sin conexión. Revisa tu red.'
    };
    show(map[err.code] || err.message);
    alert(map[err.code] || err.message);
  } finally {
    btn.disabled = false; btn.textContent = 'Ingresar';
  }
});

// Recuperación de contraseña
$('#reset-link')?.addEventListener('click', async (e) => {
  e.preventDefault();
  const email = prompt('Correo para recuperar contraseña:');
  if (!email) return;
  try {
    await sendPasswordResetEmail(auth, email);
    alert('Te enviamos un correo para recuperar tu contraseña.');
  } catch (err) {
    console.error('RESET ERROR:', err);
    alert(err.message);
  }
});

console.log('Login listo. Si al hacer clic no pasa nada, abre la consola (F12) para ver errores.');
</script>


</body>
</html>

