<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Hoteleaseali · Iniciar sesión</title>
  <link rel="stylesheet" href="../css/style.css">
  <link rel="icon" href="../img/logo.png">
</head>
<body>
<header>
  <div class="container header-inner">
    <a class="brand" href="../index.html"><img src="../img/logo.png" alt="">Hoteleaseali</a>
    <nav class="nav"><a href="./registro.html">Registro</a><a href="./panel.html">Panel</a></nav>
  </div>
</header>

<main class="container" style="padding:32px 0">
  <div class="card" style="max-width:680px;margin:auto">
    <h1>Iniciar sesión</h1>
    <p class="lead">Accede con tu correo y contraseña.</p>

    <form id="login-form" class="form-row" style="margin-top:12px">
      <label>Correo
        <input name="email" type="email" placeholder="usuario@hotel.com" required>
      </label>
      <label>Contraseña
        <input name="password" type="password" required>
      </label>

      <label style="display:flex;gap:8px;align-items:center;margin-top:4px">
        <input id="remember" type="checkbox"> Recordarme
      </label>

      <div style="display:flex;gap:12px;align-items:center;margin-top:8px">
        <button class="btn" type="submit">Ingresar</button>
        <a id="reset-link" href="#" class="module-link">¿Olvidaste tu contraseña?</a>
      </div>

      <p style="margin-top:10px">¿No tienes cuenta? <a class="module-link" href="./registro.html">Regístrate</a></p>
    </form>
  </div>
</main>

<footer><small>© 2025 Hoteleaseali</small></footer>

<script type="module" src="./firebase-init.js"></script>
<script type="module">
import { auth } from './firebase-init.js';
import {
  signInWithEmailAndPassword,
  sendPasswordResetEmail,
  setPersistence,
  browserLocalPersistence,
  browserSessionPersistence
} from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";

const $ = (s) => document.querySelector(s);
const form = $('#login-form');

form.addEventListener('submit', async (e) => {
  e.preventDefault();
  const email = form.email.value.trim();
  const pass  = form.password.value;
  const remember = $('#remember').checked;

  try {
    await setPersistence(auth, remember ? browserLocalPersistence : browserSessionPersistence);
    await signInWithEmailAndPassword(auth, email, pass);
    location.href = './panel.html';
  } catch (err) {
    const msgs = {
      'auth/invalid-credential': 'Correo o contraseña inválidos.',
      'auth/user-not-found': 'El usuario no existe.',
      'auth/wrong-password': 'Contraseña incorrecta.',
      'auth/too-many-requests': 'Demasiados intentos. Intenta más tarde.'
    };
    alert(msgs[err.code] || err.message);
  }
});

$('#reset-link')?.addEventListener('click', async (e) => {
  e.preventDefault();
  const email = prompt('Correo para recuperar contraseña:');
  if (!email) return;
  try {
    await sendPasswordResetEmail(auth, email);
    alert('Te enviamos un correo para recuperar tu contraseña.');
  } catch (err) {
    alert(err.message);
  }
});
</script>
</body>
</html>
